= Redis testing

== Redis Server

 $ docker-compose config
 $ docker-compose up -d

== Launch and test

 $ mvn spring-boot:run
 $ curl -X POST --data "message=For The Watch !" http://localhost:8080/messages/
 $ curl http://localhost:8080/messages/get/winter
 $ curl -X PUT http://localhost:8080/messages/get/winter/IsComing
 $ curl http://localhost:8080/messages/get/winter
 $ curl http://localhost:8080/messages/kings

== HealthCheck

 $ curl http://localhost:8080/health

[source, json, indent=1]
----
{
  "status": "UP",
  "diskSpace": {
    "status": "UP",
    "total": 499582496768,
    "free": 257829298176,
    "threshold": 10485760
  },
  "redis": {
    "status": "UP",
    "version": "3.2.9"
  }
}
----

=== Let's shutdown the redis-server

 $ docker-compose stop
 $ curl http://localhost:8080/health

[source, json, indent=1]
----
{
  "status": "DOWN",
  "diskSpace": {
    "status": "UP",
    "total": 499582496768,
    "free": 257825476608,
    "threshold": 10485760
  },
  "redis": {
    "status": "DOWN",
    "error": "org.springframework.data.redis.RedisConnectionFailureException: Cannot get Jedis connection; nested exception is redis.clients.jedis.exceptions.JedisConnectionException: Could not get a resource from the pool"
  }
}
----

== References

* https://spring.io/guides/gs/messaging-redis
* http://projects.spring.io/spring-data-redis
* https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples
